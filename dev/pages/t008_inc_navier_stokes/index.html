<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>8 Incompressible Navier-Stokes · Gridap tutorials</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="Gridap tutorials logo"/></a><div class="docs-package-name"><span class="docs-autofit">Gridap tutorials</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Introduction</a></li><li><a class="tocitem" href="../t001_poisson/">1 Poisson equation</a></li><li><a class="tocitem" href="../t002_validation/">2 Code validation</a></li><li><a class="tocitem" href="../t003_elasticity/">3 Linear elasticity</a></li><li><a class="tocitem" href="../t004_p_laplacian/">4 p-Laplacian</a></li><li><a class="tocitem" href="../t005_hyperelasticity/">5 Hyper-elasticity</a></li><li><a class="tocitem" href="../t006_dg_discretization/">6 Poisson equation (with DG)</a></li><li><a class="tocitem" href="../t007_darcy/">7 Darcy equation (with RT)</a></li><li class="is-active"><a class="tocitem" href>8 Incompressible Navier-Stokes</a><ul class="internal"><li><a class="tocitem" href="#Problem-statement-1"><span>Problem statement</span></a></li><li><a class="tocitem" href="#Numerical-Scheme-1"><span>Numerical Scheme</span></a></li><li><a class="tocitem" href="#Discrete-model-1"><span>Discrete model</span></a></li><li><a class="tocitem" href="#FE-spaces-1"><span>FE spaces</span></a></li><li><a class="tocitem" href="#Triangulation-and-integration-quadrature-1"><span>Triangulation and integration quadrature</span></a></li><li><a class="tocitem" href="#Nonlinear-weak-form-1"><span>Nonlinear weak form</span></a></li><li><a class="tocitem" href="#Nonlinear-solver-phase-1"><span>Nonlinear solver phase</span></a></li><li><a class="tocitem" href="#References-1"><span>References</span></a></li></ul></li><li><a class="tocitem" href="../t009_stokes/">9 Stokes equation</a></li><li><a class="tocitem" href="../t010_advection_diffusion/">10 Advection-diffusion</a></li><li><a class="tocitem" href="../t011_isotropic_damage/">11 Isotropic damage model</a></li><li><a class="tocitem" href="../t012_fsi_tutorial/">12 Fluid-Structure Interaction</a></li><li><a class="tocitem" href="../t013_emscatter/">13 Electromagnetic scattering in 2D</a></li><li><a class="tocitem" href="../t014_validation_DrWatson/">14 On using DrWatson.jl</a></li><li><a class="tocitem" href="../t015_interpolation_fe/">15 Interpolation of CellFields</a></li><li><a class="tocitem" href="../t016_poisson_distributed/">16 Poisson equation on parallel distributed-memory computers</a></li><li><a class="tocitem" href="../t017_transient_linear/">17 Transient Poisson equation</a></li><li><a class="tocitem" href="../t018_transient_nonlinear/">18 Transient nonlinear equation</a></li><li><a class="tocitem" href="../t019_TopOptEMFocus/">19 Topology optimization</a></li><li><a class="tocitem" href="../t020_poisson_unfitted/">20 Poisson on unfitted meshes</a></li><li><a class="tocitem" href="../t021_poisson_amr/">21 Poisson with AMR</a></li><li><a class="tocitem" href="../t022_poisson_hdg/">22 Poisson with HDG</a></li><li><a class="tocitem" href="../t023_poisson_hho/">23 Poisson with HHO on polytopal meshes</a></li><li><a class="tocitem" href="../t024_stokes_blocks/">24 Block assembly and solvers: Incompressible Stokes example</a></li><li><a class="tocitem" href="../t025_lagrange_multipliers/">25 Lagrange multipliers</a></li><li><a class="tocitem" href="../t026_poisson_dev_fe/">26 Low-level API - Poisson equation</a></li><li><a class="tocitem" href="../t027_geometry_dev/">27 Low-level API - Geometry</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>8 Incompressible Navier-Stokes</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>8 Incompressible Navier-Stokes</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/gridap/Tutorials/blob/master/src/inc_navier_stokes.jl" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="inc_navier_stokes.jl-1"><a class="docs-heading-anchor" href="#inc_navier_stokes.jl-1">Tutorial 8: Incompressible Navier-Stokes</a><a class="docs-heading-anchor-permalink" href="#inc_navier_stokes.jl-1" title="Permalink"></a></h1><p><a href="https://mybinder.org/v2/gh/gridap/Tutorials/gh-pages?filepath=dev/notebooks/t008_inc_navier_stokes.ipynb"><img src="https://mybinder.org/badge_logo.svg" alt/></a> <a href="https://nbviewer.jupyter.org/github/gridap/Tutorials/blob/gh-pages/dev/notebooks/t008_inc_navier_stokes.ipynb"><img src="https://img.shields.io/badge/show-nbviewer-579ACA.svg" alt/></a></p><p>In this tutorial, we will learn</p><ul><li>How to solve nonlinear multi-field PDEs in Gridap</li><li>How to build FE spaces whose functions have zero mean value</li></ul><h2 id="Problem-statement-1"><a class="docs-heading-anchor" href="#Problem-statement-1">Problem statement</a><a class="docs-heading-anchor-permalink" href="#Problem-statement-1" title="Permalink"></a></h2><p>The goal of this last tutorial is to solve a nonlinear multi-field PDE. As a model problem, we consider a well known benchmark in computational fluid dynamics, the lid-driven cavity for the incompressible Navier-Stokes equations. Formally, the PDE we want to solve is: find the velocity vector <span>$u$</span> and the pressure <span>$p$</span> such that</p><div>\[\left\lbrace
\begin{aligned}
-\Delta u + \mathit{Re}\ (u\cdot \nabla)\ u + \nabla p = 0 &amp;\text{ in }\Omega,\\
\nabla\cdot u = 0 &amp;\text{ in } \Omega,\\
u = g &amp;\text{ on } \partial\Omega,
\end{aligned}
\right.\]</div><p>where the computational domain is the unit square <span>$\Omega \doteq (0,1)^d$</span>, <span>$d=2$</span>, <span>$\mathit{Re}$</span> is the Reynolds number (here, we take <span>$\mathit{Re}=10$</span>), and <span>$(w \cdot \nabla)\ u = (\nabla u)^t w$</span>  is the well known convection operator. In this example, the driving force is the Dirichlet boundary velocity <span>$g$</span>, which is a non-zero horizontal velocity with a value of <span>$g = (1,0)^t$</span> on the top side of the cavity, namely the boundary <span>$(0,1)\times\{1\}$</span>, and <span>$g=0$</span> elsewhere on <span>$\partial\Omega$</span>. Since we impose Dirichlet boundary conditions on the entire boundary <span>$\partial\Omega$</span>, the mean value of the pressure is constrained to zero in order have a well posed problem,</p><div>\[\int_\Omega q \ {\rm d}\Omega = 0.\]</div><h2 id="Numerical-Scheme-1"><a class="docs-heading-anchor" href="#Numerical-Scheme-1">Numerical Scheme</a><a class="docs-heading-anchor-permalink" href="#Numerical-Scheme-1" title="Permalink"></a></h2><p>In order to approximate this problem we chose a formulation based on inf-sub stable <span>$Q_k/P_{k-1}$</span> elements with continuous velocities and discontinuous pressures (see, e.g., [1] for specific details). The interpolation spaces are defined as follows.  The velocity interpolation space is</p><div>\[V \doteq \{ v \in [C^0(\Omega)]^d:\ v|_T\in [Q_k(T)]^d \text{ for all } T\in\mathcal{T} \},\]</div><p>where <span>$T$</span> denotes an arbitrary cell of the FE mesh <span>$\mathcal{T}$</span>, and <span>$Q_k(T)$</span> is the local polynomial space in cell <span>$T$</span> defined as the multi-variate polynomials in <span>$T$</span> of order less or equal to <span>$k$</span> in each spatial coordinate. Note that, this is the usual continuous vector-valued Lagrangian FE space of order <span>$k$</span> defined on a mesh of quadrilaterals or hexahedra.  On the other hand, the space for the pressure is</p><div>\[\begin{aligned}
Q_0 &amp;\doteq \{ q \in Q: \  \int_\Omega q \ {\rm d}\Omega = 0\}, \text{ with}\\
Q &amp;\doteq \{ q \in L^2(\Omega):\ q|_T\in P_{k-1}(T) \text{ for all } T\in\mathcal{T}\},
\end{aligned}\]</div><p>where <span>$P_{k-1}(T)$</span> is the polynomial space of multi-variate polynomials in <span>$T$</span> of degree less or equal to <span>$k-1$</span>. Note that functions in <span>$Q_0$</span> are strongly constrained to have zero mean value. This is achieved in the code by removing one degree of freedom from the (unconstrained) interpolation space <span>$Q$</span> and  adding a constant to the computed pressure so that the resulting function has zero mean value.</p><p>The weak form associated to these interpolation spaces reads: find <span>$(u,p)\in U_g \times Q_0$</span> such that <span>$[r(u,p)](v,q)=0$</span> for all <span>$(v,q)\in V_0 \times Q_0$</span> where <span>$U_g$</span> and <span>$V_0$</span> are the set of functions in <span>$V$</span> fulfilling the Dirichlet boundary condition <span>$g$</span> and <span>$0$</span>  on <span>$\partial\Omega$</span> respectively. The weak residual <span>$r$</span> evaluated at a given pair <span>$(u,p)$</span> is the linear form defined as</p><div>\[[r(u,p)](v,q) \doteq a((u,p),(v,q))+ [c(u)](v),\]</div><p>with</p><div>\[\begin{aligned}
a((u,p),(v,q)) &amp;\doteq \int_{\Omega} \nabla v \cdot \nabla u \ {\rm d}\Omega - \int_{\Omega} (\nabla\cdot v) \ p \ {\rm d}\Omega + \int_{\Omega} q \ (\nabla \cdot u) \ {\rm d}\Omega,\\
[c(u)](v) &amp;\doteq \int_{\Omega} v 	\cdot \left( (u\cdot\nabla)\ u \right)\ {\rm d}\Omega.\\
\end{aligned}\]</div><p>Note that the bilinear form <span>$a$</span> is associated with the linear part of the PDE, whereas <span>$c$</span> is the contribution to the residual resulting from the convective term.</p><p>In order to solve this nonlinear weak equation with a Newton-Raphson method, one needs to compute the Jacobian associated with the residual <span>$r$</span>. In this case, the Jacobian <span>$j$</span> evaluated at a pair <span>$(u,p)$</span> is the bilinear form defined as</p><div>\[[j(u,p)]((\delta u, \delta p),(v,q)) \doteq a((\delta u,\delta p),(v,q))  + [{\rm d}c(u)](\delta u,v),\]</div><p>where <span>${\rm d}c$</span> results from the linearization of the convective term, namely</p><div>\[[{\rm d}c(u)](\delta u,v) \doteq \int_{\Omega} v \cdot \left( (u\cdot\nabla)\ \delta u \right) \ {\rm d}\Omega + \int_{\Omega} v \cdot \left( (\delta u\cdot\nabla)\ u \right)  \ {\rm d}\Omega.\]</div><p>The implementation of this numerical scheme is done in Gridap by combining the concepts previously seen for single-field nonlinear PDEs  and linear multi-field problems.</p><h2 id="Discrete-model-1"><a class="docs-heading-anchor" href="#Discrete-model-1">Discrete model</a><a class="docs-heading-anchor-permalink" href="#Discrete-model-1" title="Permalink"></a></h2><p>We start with the discretization of the computational domain. We consider a <span>$100\times100$</span> Cartesian mesh of the unit square.</p><pre><code class="language-julia">using Gridap
n = 100
domain = (0,1,0,1)
partition = (n,n)
model = CartesianDiscreteModel(domain,partition)</code></pre><p>For convenience, we create two new boundary tags,  namely <code>&quot;diri1&quot;</code> and <code>&quot;diri0&quot;</code>, one for the top side of the square (where the velocity is non-zero), and another for the rest of the boundary (where the velocity is zero).</p><pre><code class="language-julia">labels = get_face_labeling(model)
add_tag_from_tags!(labels,&quot;diri1&quot;,[6,])
add_tag_from_tags!(labels,&quot;diri0&quot;,[1,2,3,4,5,7,8])</code></pre><h2 id="FE-spaces-1"><a class="docs-heading-anchor" href="#FE-spaces-1">FE spaces</a><a class="docs-heading-anchor-permalink" href="#FE-spaces-1" title="Permalink"></a></h2><p>For the velocities, we need to create a conventional vector-valued continuous Lagrangian FE space. In this example, we select a second order interpolation.</p><pre><code class="language-julia">D = 2
order = 2
reffeᵤ = ReferenceFE(lagrangian,VectorValue{2,Float64},order)
V = TestFESpace(model,reffeᵤ,conformity=:H1,labels=labels,dirichlet_tags=[&quot;diri0&quot;,&quot;diri1&quot;])</code></pre><p>The interpolation space for the pressure is built as follows</p><pre><code class="language-julia">reffeₚ = ReferenceFE(lagrangian,Float64,order-1;space=:P)
Q = TestFESpace(model,reffeₚ,conformity=:L2,constraint=:zeromean)</code></pre><p>With the options <code>:Lagrangian</code>, <code>space=:P</code>, <code>valuetype=Float64</code>, and <code>order=order-1</code>, we select the local polynomial space <span>$P_{k-1}(T)$</span> on the cells <span>$T\in\mathcal{T}$</span>. With the symbol <code>space=:P</code> we specifically chose a local Lagrangian interpolation of type &quot;P&quot;. Without using <code>space=:P</code>, would lead to a local Lagrangian of type &quot;Q&quot; since this is the default for quadrilateral or hexahedral elements. On the other hand, <code>constraint=:zeromean</code> leads to a FE space, whose functions are constrained to have mean value equal to zero, which is just what we need for the pressure space. With these objects, we build the trial multi-field FE spaces</p><pre><code class="language-julia">uD0 = VectorValue(0,0)
uD1 = VectorValue(1,0)
U = TrialFESpace(V,[uD0,uD1])
P = TrialFESpace(Q)

Y = MultiFieldFESpace([V, Q])
X = MultiFieldFESpace([U, P])</code></pre><h2 id="Triangulation-and-integration-quadrature-1"><a class="docs-heading-anchor" href="#Triangulation-and-integration-quadrature-1">Triangulation and integration quadrature</a><a class="docs-heading-anchor-permalink" href="#Triangulation-and-integration-quadrature-1" title="Permalink"></a></h2><p>From the discrete model we can define the triangulation and integration measure</p><pre><code class="language-julia">degree = order
Ωₕ = Triangulation(model)
dΩ = Measure(Ωₕ,degree)</code></pre><h2 id="Nonlinear-weak-form-1"><a class="docs-heading-anchor" href="#Nonlinear-weak-form-1">Nonlinear weak form</a><a class="docs-heading-anchor-permalink" href="#Nonlinear-weak-form-1" title="Permalink"></a></h2><p>The different terms of the nonlinear weak form for this example are defined following an approach similar to the one discussed for the <span>$p$</span>-Laplacian equation, but this time using the notation for multi-field problems.</p><pre><code class="language-julia">const Re = 10.0
conv(u,∇u) = Re*(∇u&#39;)⋅u
dconv(du,∇du,u,∇u) = conv(u,∇du)+conv(du,∇u)</code></pre><p>The bilinear form reads</p><pre><code class="language-julia">a((u,p),(v,q)) = ∫( ∇(v)⊙∇(u) - (∇⋅v)*p + q*(∇⋅u) )dΩ</code></pre><p>The nonlinear term and its Jacobian are given by</p><pre><code class="language-julia">c(u,v) = ∫( v⊙(conv∘(u,∇(u))) )dΩ
dc(u,du,v) = ∫( v⊙(dconv∘(du,∇(du),u,∇(u))) )dΩ</code></pre><p>Finally, the Navier-Stokes weak form residual and Jacobian can be defined as</p><pre><code class="language-julia">res((u,p),(v,q)) = a((u,p),(v,q)) + c(u,v)
jac((u,p),(du,dp),(v,q)) = a((du,dp),(v,q)) + dc(u,du,v)</code></pre><p>With the functions <code>res</code>, and <code>jac</code> representing the weak residual and the Jacobian, we build the nonlinear FE problem:</p><pre><code class="language-julia">op = FEOperator(res,jac,X,Y)</code></pre><h2 id="Nonlinear-solver-phase-1"><a class="docs-heading-anchor" href="#Nonlinear-solver-phase-1">Nonlinear solver phase</a><a class="docs-heading-anchor-permalink" href="#Nonlinear-solver-phase-1" title="Permalink"></a></h2><p>To finally solve the problem, we consider the same nonlinear solver as previously considered for the  <span>$p$</span>-Laplacian equation.</p><pre><code class="language-julia">using LineSearches: BackTracking
nls = NLSolver(
  show_trace=true, method=:newton, linesearch=BackTracking())
solver = FESolver(nls)</code></pre><p>In this example, we solve the problem without providing an initial guess (a default one equal to zero will be generated internally)</p><pre><code class="language-julia">uh, ph = solve(solver,op)</code></pre><p>Finally, we write the results for visualization (see next figure).</p><pre><code class="language-julia">writevtk(Ωₕ,&quot;ins-results&quot;,cellfields=[&quot;uh&quot;=&gt;uh,&quot;ph&quot;=&gt;ph])</code></pre><p><img src="../../assets/inc_navier_stokes/ins_solution.png" alt/></p><h2 id="References-1"><a class="docs-heading-anchor" href="#References-1">References</a><a class="docs-heading-anchor-permalink" href="#References-1" title="Permalink"></a></h2><p>[1] H. C. Elman, D. J. Silvester, and A. J. Wathen. <em>Finite elements and fast iterative solvers: with applications in incompressible fluid dynamics</em>. Oxford University Press, 2005.</p><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../t007_darcy/">« 7 Darcy equation (with RT)</a><a class="docs-footer-nextpage" href="../t009_stokes/">9 Stokes equation »</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Monday 1 September 2025 22:01">Monday 1 September 2025</span>. Using Julia version 1.10.10.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
